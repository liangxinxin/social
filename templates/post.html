{% extends 'commons/_proto.html' %}
{% from 'commons/navbar_toutiao.html' import macro_body_navbar %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="stylesheets/community/community_home.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/community/post.css">
{% endblock %}

{% block body %}
    <div id="navbar">
    	{{ macro_body_navbar() }}
    </div>
    <input id="post_id" style="display:none" value={{post_data.id}}></input>
    <input id="community_id" style="display:none" value={{community.id}}></input>
    <div id="all_backgroud" class="all_background">
        <div id="post_wrapper" class="post_all_wraper">
            <div id="community_head" class="card_top_wrap">
                <div id="community_head_left" class="card_info">
                    <div id="community_img" class="card_image">
                        <a>
                            <img class src="https://img3.doubanio.com/icon/g35417-1.jpg">
                        </a>
                    </div>
                    <div id="community_title" class="card_title">
                       <a class="card_title_name" title="" href="http://127.0.0.1:6100/community?community_id={{community.id}}">{{community.name}}岛</a>
                       <span class="card_num_wrap">
                           <span class="card_num_label">关注：</span>
                           <span class="card_num">{{community.user_num}}</span>
                           <span class="card_num_label">贴子：</span>
                           <span class="card_num">{{community.post_num}}</span>
                       </span>
                    </div>
                </div>
            </div>
            <div id="post_info" class="post_info">
                <div id="post_head" class="post_detail_title">
                    {{post_data.title}}
                </div>
                <div class="post_detail_body">
                    <div class="post_detail_author">
                      <div class="post_detail_user_face">
                          <a>
                              <img class src="{{post_user.head_img_url}}">
                          </a>
                      </div>
                    </div>
                    <div class="post_detail_content_wrap">
                        <div class="post_detail_content_area">
                            <div class="post_detail_content">
                                <p class="post_detail_content_char">{{post_data.content}} <p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="reply_info" class="reply_info">
                {% if reply_list and reply_user_list %}
                    {%for i in range(reply_num)%}
                        <div class="reply_body">
                            <div class="reply_author">
                              <div class="reply_user_face">
                                  <a>
                                      <img class src="{{reply_user_list[i].head_img_url}}">
                                  </a>
                              </div>
                            </div>
                            <div class="reply_content_wrap">
                                <div class="reply_content_area">
                                    <div class="reply_content">
                                        <a style="color:inherit" href="javascript:void"><p>{{reply_list[i].content|safe}}</p></a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {%endfor%}
                {% endif %}
            </div>
            <div id="publish_reply" class="publish_reply_wrap">
                <!--<div style="text-align:left; height:30px; background:#f2f4f7; padding:10px 5px 0 0;">-->
                <div class="publish_reply_mark">
                    <p class="publish_reply_mark_p">发起回复</p>
                </div>
                <div id="div_reply_content" style="text-align:left; height:300px; background:#f2f4f7;padding:10px 5px 0 0;">
                    <input id="input_reply_content" type="text" style="width:500px;height:290px" />
                </div>
                <div id="div_button_reply_post" style="text-align:left; height:50px; background:#f2f4f7">
                    {% if session.get('userinfo') %}
                    <button id="button_reply_post" onclick='publish_reply()'>发表</button>
                    {%else%}
                    <button id="button_reply_post" onclick='publish_reply_no_login()'>发表</button>
                    {%endif%}
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
         //var obj=document.getElementById("button_publish_post");
         //obj.onclick=function() {
         //  publish_post();
         //}
         function publish_reply() {
           //get title
           //get content
           var content=document.getElementById("input_reply_content").value;
           var id=document.getElementById("post_id").value;
           var community_id=document.getElementById("community_id").value;
           //post request for save post
           {% if session.get('userinfo') %}
             post("/reply_publish",{"type":"publish","content":content,"create_user_id":{{session.get('userinfo')['id']}},"post_id":id,"community_id":community_id});
           {%else%}
             post("/reply_publish",{"type":"publish","content":content,"create_user_id":1,"post_id":id,"community_id":community_id});
           {%endif%}
         }
         function publish_reply_no_login() {
           alert('您需要登录后才能回复哦！');
         }
         function post(URL, PARAMS) {        
             var temp = document.createElement("form");        
             temp.action = URL;        
             temp.method = "post";        
             temp.style.display = "none";        
             for (var x in PARAMS) {        
                 var opt = document.createElement("textarea");        
                 opt.name = x;        
                 opt.value = PARAMS[x];        
                 temp.appendChild(opt);        
             }     
             document.body.appendChild(temp);        
             temp.submit();        
             return temp;        
         }     
         function search() {
             post("/search",{"query":document.getElementById("search_input").value});
         }
        // function pre_page(page_no) {
        //     window.location="/search_result?page_no="+({{page_no}}-1).toString();
        // }
        // function next_page(page_no) {
        //     window.location="/search_result?page_no="+({{page_no}}+1).toString();
        // }
    </script>
{% endblock %}
