{% extends 'commons/_proto.html' %}
{% from 'commons/navbar_toutiao.html' import macro_body_navbar %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="stylesheets/community/user.css">
    <script src="{{url_for('static', filename='lib/jquery-2.0.3.js')}}"></script>
{% endblock %}

{% block body %}
    <div id="navbar">
    	{{ macro_body_navbar() }}
    </div>
    <div id="all_backgroud" style="height:auto;min-height:1000px; background:#FFF;">
        <div id="create_user_wrap" style="width:50%;height:auto;overflow:auto; background:#FFF; text-align:center;margin:0 auto">
            <div id="create_user_info" >
                <div id="user_name_div" class="user_item_div">
                    <p class="user_item_p">名字(昵称)：</p>
                    <input type="text" id="user_name_input" class="user_item_input"/>
                </div>
                <div id="user_password_div" class="user_item_div">
                    <p class="user_item_p">密码：</p>
                    <input type="text" id="user_password_input" class="user_item_input"/>
                </div>
                <div id="user_password_div" class="user_item_div">
                    <p class="user_item_p">再次输入密码：</p>
                    <input type="text" id="user_password_input_repeat" class="user_item_input"/>
                </div>
                
                <div id="user_mobile_phone_div" class="user_item_div">
                    <p class="user_item_p">手机号： </p> 
                    <input type="text" id="user_mobile_phone_input" placeholder="" class="user_item_input"/>
                    <button style="float:left;width:100px;">发送验证码</button>
                </div>

                <div id="user_mobile_verify_code_div" class="user_item_div">
                    <p class="user_item_p">验证码： </p> <input type="text" id="user_mobile_verify_code_input" placeholder="" class="user_item_input"/>
                </div>

                <div id="user_head_img" class="user_item_div">
                    <p class="user_item_p">头像： </p>
                </div>

                <div id="user_create" style="text-align:left">
                    <button onclick="create_user()">新用户申请</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
         function post(URL, PARAMS) {        
             var temp = document.createElement("form");        
             temp.action = URL;        
             temp.method = "post";        
             temp.style.display = "none";        
             for (var x in PARAMS) {        
                 var opt = document.createElement("textarea");        
                 opt.name = x;        
                 opt.value = PARAMS[x];        
                 temp.appendChild(opt);        
             }     
             document.body.appendChild(temp);        
             temp.submit();        
             return temp;        
         }     
         function create_user() {
             var name= document.getElementById("user_name_input").value;
             var mobile = document.getElementById("user_mobile_phone_input").value;
             var password = document.getElementById("user_password_input").value;
             var head_img_url = "";
             if (name == "") {
               alert("请输入昵称");
               return;
             }
             if (mobile == "") {
               alert("请输入手机号");
               return;
             }
             //post("/user_create",{"type":"publish","name":name,"mobile":mobile,"head_img":head_img});
             var data={};
             data['type']='publish';
             data['name']=name;
             data['password']=password;
             data['mobile']=mobile;
             data['head_img_url']=head_img_url;
             $.ajax({
               type:'POST',
               url:'/do_user_create',
               data:data,
               dataType:'json',
               success:function(data) {
                 alert('create user succ!');
                 {% if next_url %}
                   window.location.href='{{next_url}}';
                 {% else %}
                   window.location.href="/community_index";
                 {% endif %}
               },
               error:function(xhr,type) {
                 alert('create user fail!');
               }
             }); 
         }
    </script>
{% endblock %}
