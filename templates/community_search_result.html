{% extends 'commons/_proto.html' %}
{% from 'commons/navbar_toutiao.html' import macro_body_navbar %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="stylesheets/community/community.css">
{% endblock %}

{% block body %}
    <div id="navbar">
    	{{ macro_body_navbar() }}
    </div>
    <div id="all_backgroud" style="height:auto; background:#FFF;overflow:auto">
        <div style="padding-top:100px; text-align:center; height:100px; background:white;overflow:auto ">
            {% if name and name !="" %}
                <input type="text" id="search_input" placeholder=""  value={{name}} style="width:400px;height:30px" onkeypress="if(event.keyCode==13) {community_search()}"> 
            {%else%}
                <input type="text" id="search_input" placeholder=""  style="width:400px;height:30px" onkeypress="if(event.keyCode==13) {community_search()}"> 
            {%endif%}
            <button id="community_search" onclick=community_search() >进入社区</button>
        </div>
        <div id="community_wrap" style="height:1100px; background:#FFF; text-align:center">
            <div id="community_list" style="width:50%;height:auto;margin:0 auto; text-align:left; background:#FFF">
                {% if object_list %}
                    {%for community in object_list%}
                        <div class="result">
                           <div class="pic">
                              <a class="nbg" href="/community?community_id={{community.id}}"  title="{{community.name|safe}}">
                                 <img class src="{{community.head_img_url}}">
                              </a>
                           </div>
                           <div class="community_content">
                               <div class="title">
                                     <a class href="/community?community_id={{community.id}}" >{{community.name|safe}}岛</a>
                               </div>
                               <div class="info"> 成员：{{community.user_num|safe}}</div>
                               <div class="describe">
                                  <p class>
                                      {{community.describe|safe}}
                                  </p>
                               </div>
                           </div>
                        </div>
                    {%endfor%}
                {% endif %}
                {% if num == 0 %}
                   {% if session.get('userinfo') %}
                        <div>
                        <p>目前还没有该岛， <a id="a_click_new_social_name" href="javascript:" onclick="click_new_social_name()">现在创建 {{name}}岛</a> </p> 
                        </div>
                    {% else %}
                        <div>
                        <p>目前还没有该岛， <a id="a_click_new_social_name" href="javascript:" onclick="click_new_social_name_no_login()">现在创建 {{name}}岛</a> </p> 
                        </div>
                    {% endif %}
                {% endif %}
                <div id="div_create_social_info" style="display:none">
                    <p id="community_name" style="display:none">{{name}}</p>
                    <div id="create_social_name" >
                        <p >名字： {{name}}岛</p>
                    </div>
                    
                    <div id="create_social_describe" >
                        <p >简介： </p> <input type="text" id="social_describe" placeholder="输入200字以内的简介" style="width:500px;height:30px;"/>
                    </div>

                    <div id="create_social_img" >
                        <p >标志图： </p>
                    </div>

                    <div id="community_create" >
                        <button onclick="create_community()">创建</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
         function post(URL, PARAMS) {        
             var temp = document.createElement("form");        
             temp.action = URL;        
             temp.method = "post";        
             temp.style.display = "none";        
             for (var x in PARAMS) {        
                 var opt = document.createElement("textarea");        
                 opt.name = x;        
                 opt.value = PARAMS[x];        
                 temp.appendChild(opt);        
             }     
             document.body.appendChild(temp);        
             temp.submit();        
             return temp;        
         }     
         function community_search() {
             post("/community_search",{"type":"query","name":document.getElementById("search_input").value});
         }
         function create_community() {
             var name= document.getElementById("community_name").innerHTML;
             var describe = document.getElementById("social_describe").value;
             var head_img = "";
             if (describe == "输入200字以内的简介") {
               alert("请输入简介");
               return;
             }
             {% if session.get('userinfo') %}
                 post("/community_create",{"type":"publish","name":name,"create_user_id":{{session.get('userinfo')['id']}},"describe":describe});
             {% else %}
                 post("/community_create",{"type":"publish","name":name,"create_user_id":1,"describe":describe});
             {% endif %}
         }
         function click_new_social_name(){
             if (document.getElementById("div_create_social_info").style.display == "none") {
                 document.getElementById("div_create_social_info").style.display = "block";
             } else {
                 document.getElementById("div_create_social_info").style.display = "none";
             }
         }
         function click_new_social_name_no_login(){
             alert('登录后才能创建新岛哦！');
         }
         window.onload=click_new_social_name;
//        function create_community() {
//            alert(document.getElementById("community_name").innerHTML);
//            post("/community_create",{"type":"publish","name":document.getElementById("community_name").innerHTML,"create_user_id":1});
//        }
        // function pre_page(page_no) {
        //     window.location="/search_result?page_no="+({{page_no}}-1).toString();
        // }
        // function next_page(page_no) {
        //     window.location="/search_result?page_no="+({{page_no}}+1).toString();
        // }
    </script>
{% endblock %}
